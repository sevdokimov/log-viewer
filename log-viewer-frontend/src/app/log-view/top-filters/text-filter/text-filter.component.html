<div #panelDropDown class="top-panel-dropdown lv-dropdown-panel-holder closeable-filter"
     [attr.filter-id]="filterId">

    <span (click)="toggleFilterPanel()"
          [class.disabled-filter]="!enabled"
          [class.modified]="hasChanges()">
        <span *ngIf="titleName">{{titleName}}</span>

        <span *ngIf="!titleName">
            {{ 'TEXT_FILTER.TEXT' | translate }}: <span class="header-script">{{titleText}}</span>
        </span>
        &nbsp;<i class="fas fa-caret-down"></i>
    </span>
    <mat-icon (click)="removeFilter()" title="{{ 'TEXT_FILTER.REMOVE_FILTER' | translate }}" class="remote-filter-icon">close</mat-icon>
    
    <div *ngIf="dropdownShown" class="lv-dropdown-panel" [class.lv-dropdown-panel-right]="dropdownRight">
        <form class="text-filter" (ngSubmit)="onApply()">
            <div class="position-relative">
                <mat-form-field class="filter-name" appearance="fill">
                    <mat-label>{{ 'TEXT_FILTER.FILTER_NAME' | translate }} <span *ngIf="name !== originalName" class="modifier-name-flag"> *</span></mat-label>
                    <input name="name-filter-input" [(ngModel)]="name" matInput>
                </mat-form-field>

                <div class="include-exclude-group">
                    <label>
                        <input type="radio" name="textIncludeExclude" [(ngModel)]="includeExclude" value="include"> {{ 'TEXT_FILTER.SHOW_ONLY_MATCHED' | translate }}
                    </label>
                    <label>
                        <input type="radio" name="textIncludeExclude" [(ngModel)]="includeExclude" value="exclude"> {{ 'TEXT_FILTER.HIDE_MATCHED' | translate }}
                    </label>
                </div>

                <div style="float: right">
                    <lv-switch [(value)]="enabled" (valueChange)="enableDisable()"
                               title="{{'TEXT_FILTER.' + (enabled ? 'DISABLE_FILTER' : 'ENABLE_FILTER') | translate }}"></lv-switch>
                </div>
            </div>

            <div class="position-relative">
                <span class="small">
                    {{ 'TEXT_FILTER.TEXT' | translate }}
                    <span *ngIf="pattern.s !== patternOriginal.s" class="modified-script-flag"
                          title="{{ 'TEXT_FILTER.SCRIPT_CONTAINS_UNSAVED_CHANGED' | translate }}"> *</span>
                </span>

                <div class="search-controls">
                    <div class="form-check form-check-inline">
                        <input id="match-case-checkbox" name="match-case-checkbox" class="form-check-input" type="checkbox"
                               [(ngModel)]="pattern.matchCase">
                        
                        <label class="form-check-label" for="match-case-checkbox">
                            {{ 'TEXT_FILTER.MATCH_CASE' | translate }}
                        </label>
                    </div>
                    <div class="form-check form-check-inline" title="{{ 'TEXT_FILTER.USE_TEXT_AS_A_REGEXP' | translate }}">
                        <input id="regex-checkbox" name="regex-checkbox" class="form-check-input" type="checkbox"
                               [(ngModel)]="pattern.regex" (change)="checkRegexp()">

                        <label class="form-check-label" for="regex-checkbox">
                            {{ 'TEXT_FILTER.REGEXP' | translate }}
                        </label>
                    </div>
                </div>

                <textarea #textInput name="text" autosize [minRows]="2" maxRows="20"
                          class="form-control" [class.regex-mode]="pattern.regex"
                          [(ngModel)]="pattern.s" (ngModelChange)="checkRegexp()"
                          (keydown)="editorKeyDown($event)"></textarea>

                <div class="regexp-error">
                    {{regexpError}}&nbsp;
                </div>
            </div>

            <div class="action-panel">
                <button mat-stroked-button title="{{ 'TEXT_FILTER.APPLY_FILTER' | translate }}" (click)="onApply()" [disabled]="!!regexpError"
                        name="apply-button">
                    {{ 'TEXT_FILTER.SAVE' | translate }}
                </button>

                <button mat-button mat-stroked-button title="{{ 'TEXT_FILTER.REVERT_CHANGES' | translate }}" (click)="onCancel()" name="cancel-button">
                    {{ 'TEXT_FILTER.REVERT' | translate }}
                </button>
            </div>
        </form>
    </div>
</div>

